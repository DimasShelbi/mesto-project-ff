(()=>{"use strict";var e=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/,t=/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/;function n(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));r&&(t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent="")}function r(e,t,n){t?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.classList.add(n.inactiveButtonClass),e.disabled=!0)}function o(n,o,c){r(o,n.every((function(n){return n.validity.valid&&("name"!==n.name||e.test(n.value))&&("link"!==n.name||t.test(n.value))})),c)}function c(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);o.forEach((function(r){n(e,r,t)})),r(c,!1,t)}function a(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),50),document.addEventListener("click",i),document.addEventListener("keydown",l)}function u(e){e.classList.remove("popup_is-opened"),setTimeout((function(){e.classList.remove("popup_is-animated")}),600),document.removeEventListener("click",i),document.removeEventListener("keydown",l)}function i(e){e.target.classList.contains("popup")&&e.target.classList.contains("popup_is-opened")&&u(e.target)}function l(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&t&&u(t)}var s={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-13",headers:{authorization:"a581d94f-cb25-4c50-b8d1-9a07a522768e","Content-Type":"application/json"}},p=function(){return fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function d(e,t,n,r,o){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),u=c.querySelector(".card__title"),i=c.querySelector(".card__like-button"),l=c.querySelector(".card__like-count"),s=c.querySelector(".card__delete-button");return a.src=e.link,a.alt=e.name,u.textContent=e.name,l.textContent=e.likes.length,e.likes.some((function(e){return e._id===t}))&&i.classList.add("card__like-button_is-active"),e.owner._id!==t?s.style.display="none":s.addEventListener("click",(function(){return n(e._id,c)})),i.addEventListener("click",(function(){return r(e._id,i,l)})),a.addEventListener("click",(function(){return o(e.link,e.name)})),c}function f(e,t){(function(e){return fetch("".concat(s.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e).then((function(){t.remove()})).catch((function(e){console.log(e)}))}function m(e,t,n){t.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){t.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){t.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){var r,o,c,a;r=e,o=t,c=n[t],a=function(e,t){if("object"!=y(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==y(a)?a:a+"")in r?Object.defineProperty(r,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[o]=c})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var b,S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};b=S,Array.from(document.querySelectorAll(b.formSelector)).forEach((function(r){!function(r,c){var a=Array.from(r.querySelectorAll(c.inputSelector)),u=r.querySelector(c.submitButtonSelector);a.forEach((function(i){i.addEventListener("input",(function(){(function(r,o,c){var a=function(n){return n.validity.valueMissing?"Это поле обязательно для заполнения.":n.validity.tooShort||n.validity.tooLong?"Длина поля должна быть от ".concat(n.minLength," до ").concat(n.maxLength," символов."):"name"!==n.name||e.test(n.value)?"link"!==n.name||t.test(n.value)?n.validationMessage:"Введите корректный URL.":"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы."}(o);!o.validity.valid||"name"===o.name&&!e.test(o.value)||"link"===o.name&&!t.test(o.value)?function(e,t,n,r){var o=e.querySelector("#".concat(t.id,"-error"));o&&(t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass))}(r,o,a,c):n(r,o,c)})(r,i,c),o(a,u,c)}))})),o(a,u,c)}(r,b)})),document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelector(".header__logo");e&&(e.src="images/logo.fc3e6875d825f899a98d.svg");var t,n=document.querySelector(".profile__image"),r=document.querySelector(".profile__title"),o=document.querySelector(".profile__description"),c=document.querySelector(".places__list");Promise.all([fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),p()]).then((function(e){var a,u,i=(u=2,function(e){if(Array.isArray(e))return e}(a=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(a,u)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(a,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=i[0],s=i[1];r.textContent=s.name,o.textContent=s.about,n&&(n.style.backgroundImage="url(".concat(s.avatar,")")),t=s._id,l.forEach((function(e){var n=d(e,t,f,m,I);c.appendChild(n)}))})).catch((function(e){console.log(e)}))}));var g=document.querySelector(".profile__edit-button"),q=document.querySelector(".popup_type_edit"),k=q.querySelector(".popup__close"),L=q.querySelector(".popup__form"),E=q.querySelector(".popup__input_type_name"),j=q.querySelector(".popup__input_type_description"),C=L.querySelector(".popup__button");g.addEventListener("click",(function(){p().then((function(e){E.value=e.name,j.value=e.about,c(q,S),a(q)})).catch((function(e){console.log(e)}))})),k.addEventListener("click",(function(){u(q)})),L.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=E.value,o=j.value;C.textContent="Сохранение...",(t=r,n=o,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){profileTitle.textContent=e.name,profileDescription.textContent=e.about,u(q)})).catch((function(e){console.log(e)})).finally((function(){C.textContent="Сохранить"}))}));var O=document.querySelector(".profile__add-button"),P=document.querySelector(".popup_type_new-card"),w=P.querySelector(".popup__input_type_card-name"),x=P.querySelector(".popup__input_type_url"),A=P.querySelector(".popup__close"),U=P.querySelector(".popup__form"),T=U.querySelector(".popup__button");O.addEventListener("click",(function(){c(P,S),a(P)})),A.addEventListener("click",(function(){u(P)})),U.addEventListener("submit",(function(e){e.preventDefault();var t=w.value,n=x.value;T.textContent="Сохранение...",function(e,t){return fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t,n).then((function(e){var t=d(v(v({},e),{},{owner:{_id:currentUserId}}),currentUserId,f,m,I);document.querySelector(".places__list").prepend(t),u(P),w.value="",x.value=""})).catch((function(e){console.log(e)})).finally((function(){T.textContent="Сохранить"}))}));var D=document.querySelector(".popup_type_image");function I(e,t){var n=D.querySelector(".popup__image"),r=D.querySelector(".popup__caption");a(D),n.src=e,n.alt=t,r.textContent=t}D.querySelector(".popup__close").addEventListener("click",(function(){u(D)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&u(e)}))}));var B=document.querySelector(".profile__image"),z=document.querySelector(".popup_type_avatar"),M=z.querySelector(".popup__form"),N=z.querySelector(".popup__input_type_avatar-url"),J=z.querySelector(".popup__close"),$=M.querySelector(".popup__button");B.addEventListener("click",(function(){c(z,S),a(z)})),J.addEventListener("click",(function(){u(z)})),M.addEventListener("submit",(function(e){e.preventDefault();var t=N.value;$.textContent="Сохранение...",function(e){return fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(e){var t=document.querySelector(".profile__image");t&&(t.style.backgroundImage="url(".concat(e.avatar,")")),u(z),N.value=""})).catch((function(e){console.log(e)})).finally((function(){$.textContent="Сохранить"}))}))})();